<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Caterpillar</title>

    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
    <canvas width="800" height="800" id="capi" class="mx-auto m-16" data-raw-handle="1">
        Display for a game written in Caterpillar.
    </canvas>
    <script type="module">
        import init from "/capi.js";
        const wasm = await init("capi_bg.wasm");

        window.addEventListener("keydown", (event) => {
            let keyCode = null;

            if (event.key == "ArrowUp" || event.key == "w") {
                keyCode = 1;
            }
            if (event.key == "ArrowLeft" || event.key == "a") {
                keyCode = 2;
            }
            if (event.key == "ArrowDown" || event.key == "s") {
                keyCode = 3;
            }
            if (event.key == "ArrowRight" || event.key == "d") {
                keyCode = 4;
            }

            if (keyCode != null) {
                wasm.on_key(keyCode);
                event.preventDefault();
            }
        });

        window.requestAnimationFrame(mainLoop);

        function mainLoop() {
            wasm.on_frame();
            requestAnimationFrame(mainLoop);
        }
    </script>
    <script type="module">
        fetch("/updates").then((response) => {
            if (response.ok) {
                window.location.reload();
            }
            else {
                console.error("`/updates` returned error:");
                console.error(response);
            }
        });
    </script>
</body>

</html>